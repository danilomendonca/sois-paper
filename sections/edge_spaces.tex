


\section{Self-organizing Interaction Spaces}\label{sec:edge_spaces}

\subsection{Role-orientation}

%1: functional plasticity of nowaday's devices
With the technology advancements, a class of pervasive devices acquired the ability to perform general purpose computing, as well as to communicate by different means and perceive the physical world through multiple sensors. These enhancements entails a \textit{functional plasticity}, i.e., the ability of these devices to provide variations of their functionalities not only for different applications, but also in different contexts of the same application. 

%2: from functional plasticity to a separation of functionalities
In a client-server architecture, commonly used nowadays, the instances of a pervasive application depend on remote servers. The functionalities provided by each client are self-contained and do not address the needs of other clients. Hence, clients are symmetric with respect to each other; asymmetry is restricted to the relation between clients and servers. 
In an different model, the functional plasticity of smartphones and other devices could be explored by letting application instances (hereafter referred to as an \textit{application node}) to assume distinct functionalities.

%, i.e., to assume different responsibilities over the application organization.

%In contrast with this rigid symmetry, 
%with the rigid symmetry that characterizes the behavior performed by client nodes in a client-server architecture -- commonly used in today's applications -- 
%or compared to the narrow set of functionalities provided by specialized and extremely resource-constrained devices, 

%3: definition of a functional role
%In Role Theory, a \textit{role} defines a context in which an individual is expected to exhibit some behavior or pattern of behavior~\cite{}. 
In an organizational structure, a functional role defines the responsibility an individual over specific goals. 
%4: why they are important for pervasive applications
Considering the collection of nodes from a pervasive application as an organization, a role can be defined as a context in which one or more application nodes must provide/perform certain functionalities/behaviors. Different reasons may motivate a \textit{separation-of-responsibilities} among application nodes.
%4.1a: the case of MCS; application nodes are employers of an organization, which must efficiently employ their resources
For instance, with the purpose of increasing the \textit{efficiency} with which the organization achieve its goals. That is:
\begin{itemize}
	\item  specific roles can be played by a subset of the available nodes (e.g., only a subset of nodes in a given region must collect data about the noise pollution); or
	
	\item performance, quality and other attributes may depend on which nodes are assigned for a task (e.g., nodes with access to more powerful computational resources, sensors with higher accuracy, or stronger wireless signals).
\end{itemize}

%4.1b: why did I mention organization efficiency as a motivation
%Today, MCS is the main class of application in which mobile devices are employed not to satisfy its owners needs, but the needs of external actors (e.g., a public institution responsible for monitoring the noise pollution in certain urban areas). Despite their uniqueness, the broad range of MCS applications justifies the inclusion of efficiency as a motivation. 

%4.2: the case of collaboration among nodes
In addition, separation-or-responsibilities becomes evident whenever the nodes of an application need to achieve their individual or common goals in a \textit{collaboratively} way:

\begin{itemize}
	
	\item nodes have a resource or capability that others do not have (e.g., sensors, Internet connection, processing capabilities, memory, storage, battery level, etc); or
	
	\item functionality that benefits multiple nodes can be provided by one or a subset of them.
	
\end{itemize}

%TODO merge below with above

%1: The today's client-server model and the need for role-orientation
In today's client-server model, the different functionalities are modeled and programmed as part of a monolithic application. For the applications whose nodes are expected to interact, collaborate and play others than just the role of a client from a backend server, the distinct functionalities of each role form a concern of their own, i.e., they must be designed and programmed accordingly. 

%2: What do we propose in terms of role-orientation
In this work, we inherit the concept of a role, commonly used in human organizations, as part of a framework for the engineering of pervasive applications. By making the concept of a role a first-class abstraction, we provide the means to, since the early stages of its development, reason on the organizational aspects of the application, namely:

\begin{itemize}
	
	\item what are the roles in the application-to-be;
	
	\item what functionalities must be provided by each role;
	
	\item what capabilities are required by these functionalities; and
	
	%(e.g., computational resources, specific hardware components, etc); 
	
	\item how existing roles relate to each other, including: 
	
	\begin{enumerate}[label=-]
		
		\item the data flow, e.g.:
			\subitem coordinator $\leftarrow$ coordinated 
			\subitem aggregator  $\rightarrow$ sensors 
	
		\item their control hierarchy, e.g.:%. E.g.: 
			\subitem orchestration (hierarchical)
			\subitem choreography (non-hierarchical)
	
		\item their symmetry, i.e.:
			\subitem between same roles (symmetric) 
			\subitem between different roles (asymmetric)
		%. E.g.: symmetric relation between file-sharing peers, or asymmetric relations between server/client, supervisor/follower, coordinator/coordinated, provider/consumer, etc
		
	\end{enumerate}	
	
\end{itemize}

Figure~\ref{fig:asymmetry} illustrates cases of both symmetrical and asymmetrical relations among functional roles. 

\begin{figure}[t!]
	\centering
	\includegraphics[width=0.48\textwidth]{figures/asymmetry}
	\caption{Left: application nodes perform the same behavior (e.g., content sharing); middle: application nodes perform asymmetric roles without hierarchy among them (e.g., different sensing tasks); right: one node performs an hierarchical control (e.g., coordinator) or communication (e.g., data aggregator).}
	\label{fig:asymmetry}
\end{figure}

%TODO: add here the fitness function definition and examples

\subsection{Groups}\label{sec:groups}

\begin{figure}[t!]
	\centering
	\includegraphics[width=0.9\linewidth]{figures/group_view}
	\caption{Example of a group with a  membership criteria; out of 7 members, 2 nodes are idle (light blue) and 5 nodes are playing one of two types of roles: 1 node (red) plays a role related to the role played by the 4 others nodes (orange);}
	\label{fig:group_view}
\end{figure}

%1: Briedge with the role abstraction
The application organization -- so far represented by the roles that can be played by its nodes -- may be further characterized by its divisions, here named as \textit{groups}. 

%2: What a group is for an organization
At its highest level, a group boundary is limited by the network partition in which application nodes can interact. Nonetheless, these nodes, or a subset of them, may exhibit common properties or states of interest to the application. For instance, nodes may be grouped according to a \textit{functional} criteria (e.g., a group of nodes able to fetch data from a specific type of sensor), a \textit{non-functional} criteria (e.g., all nodes within a specific geographical area), or a mix of both (e.g., all nodes able to fetch data from a specific type of sensor within a specific geographical area). 

%Thus, multiple types of criteria may define the membership of a group.

%2: What a group is for a node
To its members, a group defines a \textit{social context} in which they (a) may or (b) must play certain roles. As the first case models a more general case of later case, we adopt a relaxed membership causality (a), i.e., group membership only defines the context in which its members \textit{may} play one or more roles, unless the group specification makes such restriction. Each of these cases are specified as follows:

\begin{itemize}
	
	\item \textbf{Strict:} a m-m specification (m instances of a role in a group of m nodes) defines a strict membership, i.e., a role that must be played by all members.
	
	\item \textbf{Relaxed:} a k-m specification defines a relaxed membership, i.e., a role to be played by a subset $K$ of the set $M$ of nodes in the group, with $|K| = k$, $|M| = m$, and $k < m$.
	
\end{itemize}

%3: The k-out-of-m allocation problem
Whenever the group specification is relaxed, the actual distribution of roles to group members must be decided dynamically (k-out-of-m allocation problem). This kind of specification is particularly useful for applications that explore the resources from a crowd of devices. For example, in mobile crowd-sensing, due to the potentially high density of devices within a given area, there may be a surplus of nodes able to perform one or more sensing tasks. Accordingly, a crowd-sensing group could be formed by all capable nodes, and only a few would actually be playing the sensing roles (after solving the k-out-of-m allocation). Figure~\ref{fig:group_view} shows the representation of a group with relaxed membership specification and two types of roles.

%4: The refined k-out-of-m allocation problem
The same reasoning applies to a group specified with two or more types of roles. If there is no predefined criteria for their assignment to specific nodes (e.g., based on the class of hosting devices), nodes must also agree on the specific roles they will play. Figure~\ref{fig:rationale} summarizes the rationale behind the assignment of functional roles to the nodes of an application based on their social and individual contexts.

%5: Role fitness and group specification
%Once the cases in which roles must be dynamically assigned to the members of a group has been depicted, and before moving to the more concrete group specification, we introduce the last key concept of the framework: the \textit{role fitness}. 

\subsection{Group-Role Specification}\label{sec:group_specification}


%1: What a role fitness is
Depending on the functionality to be provided by an application role, there may be some objective criteria to guide the decision of which nodes, at a given context, are suitable or represent the best candidates to play that role. To this end, we propose the specification of a \textit{role fitness} as a function composed of:

\begin{itemize}
	
	\item \textbf{Restrictive criteria:} consists of boolean variables whose satisfaction is a required condition for a role to be played by an application node.
	
	\item \textbf{Comparative criteria:} consists of the positive real scale indicating the fitness of a node in playing a role.
	
\end{itemize}

%The modeling of an application group starts with the specification of its membership criteria. 

%2: What each part composing a role fitness is useful for
Restrictive criteria is useful for filtering out nodes whose static (e.g., a hardware component) or dynamic (e.g., the battery level) capabilities are not compatible with the functionalities to be provided by a role. In contrast, comparative criteria distinguishes capable nodes in terms of their fitness to play a role. Thus, this type of criteria must be taken into account by the solution of the k-out-of-m role allocation problem. Next, a list of static and dynamic aspects of pervasive devices are presented as potential restrictive or comparative criteria:

\begin{itemize}
	
	\item Static criteria
	
	\begin{itemize}
		\item \textbf{Hardware capabilities:} refers to the presence of a given hardware component/module. E.g.: camera, GPS, thermometer, accelerometer, gyroscope, etc.
	\end{itemize}
	
	\item Dynamic criteria
	
	\begin{itemize}
		\item \textbf{Physical world:} refers to the physical world states a node must operate in. E.g.: its current battery level, available memory, geolocation coordinates, acceleration, speed, temperature, etc.
		
		\item \textbf{Application domain:} refers to the application states a node must be to belong to a group. E.g.: currently a member of another group (or non-member), joining a chat or game session, etc.
	\end{itemize}
\end{itemize}


%As SOIS refers to the collective of application nodes and their dynamic relations, 

To enable a flexible, intuitive, and unified placeholder for both group and role specifications, we propose the use of an hierarchical syntax. For this, we have used the eXtensible Markup Language (XML), as its standardized and well-known syntax enables the hierarchical representation of groups and roles, as well as the definition of their attributes. Next, we illustrate this specification for each of the two examples in Section~\ref{sec:motivating}.

\lstset{
	language=XML,
	breaklines=true,
	backgroundcolor=\color{lightgrey},
	basicstyle=\small\color{black},
	keywords={group,cardinality,role,name,criteria,type,term,value,minimum,maximum, pattern, after},
	keywordstyle={\bfseries\color{blue}},
	numbers=left,
	numbersep=5pt,
	numberstyle=\tiny\color{black}
}

\subsubsection{Collaborative Music Streaming} for this application, we envisioned one group with a single streamer role position (lines 1 and 3 in Listing~\ref{lst:ms_criteria}). As the functionalities of this role requires both Internet (to stream music from remote servers) and Bluetooth (to stream music to the stereo), two restrictive criteria have been added for both Internet and Bluetooth capabilities (lines 4 and 5). Finally, as the activity of streaming data in both directions are battery consuming, an additional criteria (line 6) has two purposes: a restrictive one (only devices with more than 20\% battery) and a comparative one (the best candidates are those with more battery level).

\begin{lstlisting}[caption=Specification of the music streaming group, label=lst:ms_criteria, captionpos=t]
<group name="music-streaming">

  <role name="streamer" cardinality="1">
    <criteria type="boolean" term="INTERNET" value="TRUE" />
    <criteria type="boolean" term="BLUETOOTH" value="TRUE" />
    <criteria type="float" term="BATTERY_LEVEL" minimum="20" />
  </role>
</group>
\end{lstlisting}

\subsubsection{Public Transport Monitoring}  

%TODO Remember to mention the importance of saving battery and other resources as a condition for the participation of users in MCS campaings
a MCS application aims to monitor the real-time geolocation of public buses -- to notify waiting passengers about their whereabouts -- and to register and later report unusual acceleration and deceleration events that may affect the user experience in this service. To address this scenario, a \textit{bus-monitoring} group (lines 1 in Listing~\ref{lst:bm_criteria}) is defined with three roles: a geolocator (line 5), an accelerometer (line 10), and an aggregator (14). In contrast with the previous example, a group level criteria (line 3) has been added, which means all roles inherit a minimum battery level of 15\% as a restrictive criteria. This criteria is overwritten by the geolocator role (line 6), as the GPS sensor consumes significantly more battery. Also, each sensing role has a corresponding restrictive criteria for the sensor it requires (lines 7 and 11). Finally, as the aggregator is responsible for receiving data from the other nodes and sending a preprocessed version to the backend server, Internet has been added as a restrictive criteria.

Another novelty in Listing~\ref{lst:bm_criteria} is the parametrized cardinality ($k1$ and $k2$). We intentionally left these fine-tunning parameters unspecified as the actual number of instances of each sensing role may depend on the context they operate: the higher the overall accuracy, less samples need to be aggregated. Hence, at runtime, the aggregator could provide feedback with respect to $k1$ and $k2$ based on the data it receives from the instances of each sensing role. 



\begin{lstlisting}[caption=Specification of a bus monitoring group, label=lst:bm_criteria, captionpos=t]
<group name="bus-monitoring">
  
  <criteria type="float" term="BATTERY_LEVEL" minimum="15"/>
  
  <role name="geolocator" cardinality="k1">
    <criteria type="boolean" term="GPS" value="TRUE" />
    <criteria type="float" term="BATTERY_LEVEL" minimum="30" />
  </role>
  
  <role name="accelerometer" cardinality="k2">
    <criteria type="boolean" term="ACCELEROMETER" value="TRUE" />
  </role>
  
  <role name="aggregator" cardinality="1">
    <criteria type="boolean" term="INTERNET" value="TRUE" />
  </role>
</group>
\end{lstlisting}

To avoid disturbing the users with the need of starting the application whenever they are within a bus, a fully opportunistic crowd-sensing solution~\cite{Guo:2015} requires the automatic detection of such context. By means of our framework, the facts defining this context can be modeled and later verified by the application. For example, if we assume that city buses provide wi-fi service -- as in an increasing number of real case scenarios -- the context of a passenger inside a bus ride can be defined with the additional restrictive criteria in Listing~\ref{lst:br_criteria}.

\begin{lstlisting}[caption=Additional criteria to specify a bus ride context, label=lst:br_criteria, captionpos=t]
<group name="bus-monitoring">

  <criteria type="string" term="BSSID" pattern="COMPANY_NAME" />
  <criteria type="float" term="WIFI_SIGNAL" minimum="50" />
  <criteria type="boolean" term="MOOVING" value="TRUE" after="300" />
  
  (...)

</group>
\end{lstlisting}

The additional criteria in Listing~\ref{lst:br_criteria} should be parsed as follows: the BSSID criteria (line 1) requires that a Wi-Fi with a basic service set identifier (BSSID) matching the pattern used by the bus company (e.g., the company's name); plus, the WI-FI signal strength (line 3) must not be less than 50\%, meaning the user is likely a passenger within the bus and not just in a nearby location. Finally, an important criteria identifying a bus ride is given by mobility: if the device's location, as measured by low-power detection methods like triangulation, remains unchanged for large periods, the use is either not in a bus ride or the bus is jammed and must not have its location monitored until it resumes its trip. In particular, this criteria has been modeled (line 5) with a boolean condition that fails unless it has been satisfied for more than 5 minutes (300 seconds).

Each criteria in a group-role specification can be mapped to a concrete function returning either a boolean value (for restrictive) or a float value (for comparative). The conjunction of these terms produces what we define as a \textit{restrictive function} and a \textit{fitness function}:

\begin{equation}\label{eq:rrc}
rrc(C_r) = rc_1(c_1) \wedge rc_2(c_2) \wedge ... \wedge rc_i(c_i)
\end{equation}

\begin{equation}\label{eq:fitness}
f(C_c) = cc_1(c_1) \wedge cc_2(c_2) \wedge ... \wedge cc_j(c_j)
\end{equation}

\noindent
with $C_r$ and $C_c$ the set of measurable context facts (restrictive and comparative, respectively) for a role. Last but not least, the entrance of a node to a group (group membership) is conditioned to its satisfaction of at least one $rrc$, i.e.:

\begin{equation}\label{eq:membership}
gm([C_{r1},...,C_{rp}]) = rrc_1(C_{r1}) \vee ... \vee rrc_p(C_{rp})
\end{equation}

