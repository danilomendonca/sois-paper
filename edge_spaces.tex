\section{Self-organizing Interaction Spaces}\label{sec:edge_spaces}

%THE WOLRD CONTEXT (PHYSICAL + SOCIAL) --> THE NODE CONTEXT (ROLE) --> THE NODE BEHAVIOR
\begin{figure*}[t!]
	\centering
	\includegraphics[width=0.95\linewidth]{figures/rationale}
	\caption{Role-orientation rationale}
	\label{fig:rationale}
\end{figure*}


\subsection{Role-orientation}

%behaviors and responsibilities that an individual or a group of individuals can assume. 

%8: The today's client-server model and the need for role-orientation
In today's client-server model, the functionalities to be performed by the application nodes are seen as as monolithic. For the applications whose nodes are expected to collaborate and play others than just the role of a client, the functionalities that are particular to distinct application roles form a concern of their own, i.e., they must be designed and programmed accordingly. 

%9: What do we propose in terms of role-orientation
In this work, we inherit the concept of a role, more commonly used in human organizations, as part of a framework for the engineering of pervasive applications. By making the concept of a role a first-class abstraction, we provide the means to, since the early stages of its development, reason on the organizational aspects of the application, namely:

\begin{enumerate}[label=\roman*]
	
	\item what are the roles in the application-to-be;
	
	\item what functionalities must be provided by each role;
	
	\item what capabilities are required by these functionalities; and
	
	%(e.g., computational resources, specific hardware components, etc); 
	
	\item how existing roles relate to each other: 
	
	\begin{enumerate}[label=-]
		
		\item the hierarchy of control%. E.g.: a coordinator and its coordinated;
		
		\item the flow of data%. E.g.: from sensors to an aggregator;
	
		\item the symmetry%. E.g.: symmetric relation between file-sharing peers, or asymmetric relations between server/client, supervisor/follower, coordinator/coordinated, provider/consumer, etc
		
	\end{enumerate}	
	
\end{enumerate}

%DISCUSSION
%I don't know if a need a fitness criteria or a group membership criteria.
%While the first is a comparative one, the later just filters what nodes can be or cannot be in a group.
%This doubt has much to do with the interpretation of what a group is.
%Before, a group had a stric semantical relation with the role within: a group was always a group of a specific type of agent, like a vaccum cleaner or a humidity sensor or an actuator. Thus, I have envisioned the membership criteria strongly coupled to the needs of a single role within the group.
%That been said, now I must reason on the more heterogeneous sense of a group. What if I want to define, in terms of A-3, different criteria for the followers and for the supervior? 

\lstset{
	language=XML,
	breaklines=true,
	backgroundcolor=\color{lightgrey},
	basicstyle=\color{blue},
	keywords={group,cardinality,role,name,criteria,type,term,value,minimum,maximum},
	keywordstyle={\bfseries\color{blue}}
}
\begin{lstlisting}[caption=Specification of the music streaming group, label=lst:ms_criteria, captionpos=b]
<group name="music-streaming">
  <role name="streamer" cardinality="1">
    <criteria type="boolean" term="INTERNET" value="TRUE" />
    <criteria type="boolean" term="BLUETOOTH" value="TRUE" />
    <criteria type="float" term="BATTERY_LEVEL" minimum="25" />
  </role>
</group>
\end{lstlisting}

%Similarly to well studied allocation of tasks to agents/robots with dynamic and distinct capabilities~\cite{}, mobile devices are heterogeneous and subject to hight volatility, therefore their fitness in performing different tasks varies from one device to the other and throughout time. 

%and contextualization, the dynamic allocation of tasks to different application nodes is a central feature that further distinguishes this work from previous frameworks~\cite{}. 


%their need to send/receive from each other application data or control directives (or both). 
%For instance, a coordinator is responsible for controlling the activities of its coordinates and an aggregator is responsible for aggregating data from multiple sources. The relation between roles may be further characterized by the multiplicity in each side of the relation. 



%For this, there must be a clear separation of concerns and modularization of the application logic from different roles. 


%Whereas the type of role depends on the domain of the application, in this paper we propose general abstractions and mechanisms to address the range of pervasive applications whose functionalities may be asymmetrically distribute among its nodes. 



%The relation between roles is defined based on what they are expected to provide one another. For instance, a node may be responsible for giving control directives to other nodes or to process a batch of data from other nodes. For instance,
%TODO refine this paragraph and add examples from the other motivating scenarios 
%in opportunistic MCS, application nodes may collaborate by aggregating fetched data from multiple devices into a single device~\cite{Rajagopalan:2006}, which in turn sends a preprocessed data to the server (e.g., the one with higher battery level). Thus, one-out-of-many nodes must assume the role of an aggregator, meaning that the functional role of this node changes to fit a given context. Also, if the number of nodes at a given moment is high, not every node must perform the same sensing tasks. Instead, a subset of application nodes can be assigned to a subset of sensors, reducing the overall battery consumption and networking. Once again, the functional role of these nodes varied to reflect the context they were exposed. 

%Together, the specification of what a role does (behavior specification) and how it interacts with other roles (social specification) defines the organization structure of the application. 

%FIGURE: CIRCLE WITH HALF SYMMETRIC HALF ASYMMETRIC BEHAVIOR

%TODO: add here the fitness function definition and examples

\subsection{Groups}

\begin{figure}[t!]
	\centering
	\includegraphics[width=0.85\linewidth]{figures/group_view}
	\caption{Example of a group with a relaxed membership criteria; out of 7 members, 2 nodes are idle (light blue) and 5 nodes are playing one of two types of roles: 1 node (red) plays a role related to the role played by the 4 others nodes (orange);}
	\label{fig:group_view}
\end{figure}


%From the collective of roles to the collective of grouped roles
%Why to group nodes together?
%What defines a group?
%How grouping works?

%Further refines the context of an application node: the role is not automatically set, but must be agreed 
%Strict vs relaxed group membership
%Figure of a circle representing the set of members and an inner circle representing the active members
%Relation of a group and the physical space

%Group membership criteria filters out heterogeneity

%The paradigm shift from a bipolar into a multi-polar organization discussed by this paper is strongly motivated by the co-existence of a plethora of pervasive devices from different kinds in the physical space inhabited by people. As human society evolves and blends itself with a fabric of interconnected cyber-physical devices, a question emerges: how should this ecosystem be organized? Whereas the client-server has been proven a simple and scalable answer, the potential of peer-to-peer interactions must not be ignored.

%Three dimensions characterizes the ecosystem of applications hosted by pervasive and mobile devices: \textit{space}, \textit{time}, and \textit{heterogeneity}. 


%Figure~\ref{fig:rationale} illustrates the rationale behind the assignment of roles to an application node.

%The combination of the social context with the individual context of each node 

%1: Briedge with the role abstraction
The application organization -- so far represented by the roles that can be played by its nodes -- may be further characterized by its divisions, here named as \textit{groups}. 

%2: What a group is for an organization
At its highest level, a group boundary is limited by the network partition in which application nodes can interact. Nonetheless, these nodes, or a subset of them, may exhibit common properties or states of interest to the application. For instance, a group may have a \textit{functional} meaning (e.g., a group of nodes able to fetch data from a specific type of sensor), a \textit{non-functional} meaning (e.g., all nodes within a specific geographical area), or a mix of both (e.g., all nodes able to fetch data from a specific type of sensor within a specific geographical area). 

%Thus, multiple types of criteria may define the membership of a group.

%2: What a group is for a node
To its members, a group defines a \textit{social context} in which they (a) may or (b) must play certain roles. As the former case can be seen as a more general case of later case, we adopt a relaxed membership causality (a), i.e., group membership only defines the context in which its members \textit{may} play one or more roles, unless the group specification makes such restriction. Each of these cases are specified as follows:

\begin{itemize}
	
	\item \textbf{Strict:} a m-m specification (m instances of a role in a group of m nodes) defines a symmetric role, i.e., a role that must be played by all members.
	
	\item \textbf{Relaxed:} a k-m specification defines an asymmetric role, i.e., a role to be played by a subset $K$ of the set $M$ of nodes in the group, with $|K| = k$, $|M| = m$, and $k < m$.
	
\end{itemize}

Whenever the relation between nodes in a group is asymmetric, and there is no predefined criteria for their allocation, nodes must agree on the specific roles they will play (a). Conversely, if the relation between nodes in a group is symmetric, there is no decision to be made: all nodes must play the same role (b). Figure~\ref{fig:asymmetry} illustrates cases of both symmetrical and asymmetrical relations within a group. 



%TODO: look out for the difference between asymmetric group-role relation and asymmetric role-role relation

%TODO: this paragraph talks about symmetry between roles, not about the group membership causality
%For instance, in a peer-to-peer file sharing group,
%% can be considered as a collaboration between 
%nodes play symmetric roles (all nodes plays both clients and servers roles). In contrast, any kind of relation between role, including the common cases in which one node in the group interacts with all other members through an hierarchical relation (e.g., a supervisor and its followers~\cite{Baresi:2011}), configures an asymmetric relation. 

%TODO what is the purpose of this paragraph?
%Furthermore, once this specification exists, group members must agree on the actual allocation of roles. Such \textit{distributed role allocation} mechanism is presented in Section~\ref{sec:self_organization}.

\begin{figure}[t!]
	\centering
	\includegraphics[width=0.48\textwidth]{figures/asymmetry}
	\caption{Left: application nodes perform the same behavior (e.g., content sharing); middle: application nodes perform asymmetric roles without hierarchy among them (e.g., different sensing tasks); right: one node performs an hierarchical control (e.g., coordinator) or communication (e.g., data aggregator).}
	\label{fig:asymmetry}
\end{figure}


%Due to the potentially high density of application nodes within a given zone/network, there may be a surplus of nodes able to perform one or more roles. Hence, instead of adopting a strict causality (I) between group membership and the role(s) to be played, we adopt a relaxed causality (II) in which group membership defines only the context in which its members \textit{may} play certain roles (precondition). This decision has the advantage to reduce the role assignment scope, as eligible nodes are picked from the group and not from the whole set of application nodes. 

%for applications such as MCS, in which application nodes provides functionalities whose purpose is to address the needs of an external actor and not the users themselves, 




%For example, 10 out of 15 devices are capable to measure the noise level, but only two are needed. In one hand, if the membership to a noise-pollution group would imply sensing the noise (I), only two nodes would be allowed in the group. Also, the distributed election of these two members would include all 15 devices, even those not able to perform such behavior. In the other hand, if membership implies capability (II), all 10 capable nodes would join the group and the distributed election of the two nodes would happen among the 10 member.

%Hence, at a first level, groups provide a subspace in which its members may (II) play specific roles. 

%TODO: go into details about what happens once a group is formed and roles are allocated, i.e., how roles interact with each other



Within a group, member nodes are aware of each other. Not only they can agree on which roles should be performed by which nodes, the elected roles can engage in interactions following an architectural style specified for them. Thus, a group abstraction provides a container to which roles can be added or removed dynamically. 

Considering the functional plasticity and role asymmetric previously discussed, more than one type of role may co-exist in a group. Also, the distribution of roles to the group members should follow a \textit{fitness criteria}. This criteria must provide a metric indicating which nodes are best suit to play the group roles.


The modeling of an application group starts with the specification of its membership criteria. Any type of criteria that can be modeled as a proposition and evaluated is a potential criteria, including:

\begin{itemize}
	
	\item Static criteria
	
	\begin{itemize}
		\item \textbf{Hardware capabilities:} refers to the presence of a given hardware component/module. E.g.: camera, GPS, thermometer, accelerometer, gyroscope, etc.
	\end{itemize}
	
	\item Dynamic criteria
	
	\begin{itemize}
		\item \textbf{Physical world:} refers to the physical world states a node must operate in. E.g.: its current battery level, available memory, geolocation coordinates, acceleration, speed, temperature, etc.
		
		\item \textbf{Application domain:} refers to the application states a node must be to belong to a group. E.g.: currently a member of another group (or non-member), joining a chat or game session, etc.
	\end{itemize}
\end{itemize}

For example, a mobile crowdsensing campaign is designed to monitor the real-time geolocation of public buses in a city and to register unusual acceleration and deceleration events that may affect the user experience in this service. To avoid disturbing the users with the need of starting the application whenever they are within a bus, an opportunistic approach~\cite{} requires the automatic detection of such context. In this example, we assume city buses to provide wi-fi. Accordingly, a \textit{bus group} is specified with the following criteria:

\begin{itemize}
	
	\item Bus Group Membership Criteria
	
	\begin{itemize}
		
		\item Wi-Fi BSSID matches a well-known pattern; AND
		
		\item Wi-Fi signal is not weak; AND
		
		\item Device's location has changed in the last 5 minutes
		
	\end{itemize}
	
\end{itemize}

With this criteria, a background service checks for a given pattern in the BSSID of the Wi-Fi detected by the device, as the transport provider is likely to use a BSSID that identifies the company service. If that pattern is found and if the corresponding signal is not weak (meaning the user is likely to be inside the bus), the last criteria filters out any device in the proximity of parked buses. Once these criteria are met, the application node may join or create a bus group.

Each measurement target by the campaign -- geolocation and acceleration -- is provided by independent sensors -- namely GPS and accelerometer. Thus, two additional groups are specified with the following criteria:

\begin{itemize}
	
	\item Geolocation Group Membership Criteria
	
	\begin{itemize}
		
		\item Member of the Bus Group; AND
		
		\item Has GPS; AND
		
		\item Battery level above 40\%
		
	\end{itemize}
	
	\item Acceleration Group Membership Criteria
	
	\begin{itemize}
		
		\item Member of the Bus Group; AND
		
		\item Has accelerometer; AND
		
		\item Battery level above 25\%
		
	\end{itemize}
	
\end{itemize}

Both criteria are similar, except for the type of sensor the device must have and its minimum battery level. As the GPS is known for been a battery consuming sensor, a higher battery threshold has been specified, meaning only devices with 40\% of battery or more are eligible to join that group (in contrast to the minimum level of 25\% for the acceleration group). Finally, the first criteria refers to the membership to the bus group, which indicates that a node is within a bus to be monitored.


%QUESTION: is the specification of how roles should interact inherent to the role specification or to the group specification? If the interaction should happen between roles of different kind, this specification do not belong to one role class; it can belong to the group, which allows different groups to define different architectural styles for the same class of role. Thus, I believe this specification belongs to the group in which a role is to be played. 

%Additionally, groups provide a well defined scope in which these roles can interact according to a specified architectural style. Functional groups are further associated with the roles that can 

%s a functional group is associated to a set of functionalities, its specification must also include the intended type of role(s) to be played. In addition to that, its specification must define the relation between these roles, i.e., how they interact.  

%In addition to the functional precondition aspect, a group membership criteria may also be useful to group correlated nodes according to some application semantic. For instance, 

%Due to the heterogeneity and volatility of the devices hosting a mobile application, some nodes may not satisfy the requirements to perform one or more roles. Conversely, the nodes that satisfy these requirements form a group of eligible nodes. 


%\begin{figure}[t!]
%	\centering
%	\begin{subfigure}[b]{0.4\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{figures/physical_view}
%		\caption{Spatial criteria: application components (white circles) grouped by their position in the physical space (blue shapes).}
%		\label{fig:spatial_criteria}
%	\end{subfigure}%
%	
%	\begin{subfigure}[b]{0.4\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{figures/logical_view}
%		\caption{Virtual criteria: application components (white circles) grouped by logical criteria defined by the application.}
%		\label{fig:virtual_criteria}
%	\end{subfigure}
%	\caption{Application nodes grouped by different types of criteria}
%	\label{fig:grouping_criteria}
%\end{figure}

%Whereas the isolation provided by groups can be achieved using  methods that limit the audience of messages -- for instance,  publish/subscribe mechanisms in which events are only captured by registered listeners -- the group abstraction complement the organizational view of the system provided by the role abstraction and make its social aspect more explicit. Together, these abstractions form the building blocks that allow engineers to think and program highly distributed mobile applications in terms of their organizational structure. The decision of which communication and coordination methods to use within each group remains orthogonal: message queues, events, and data-centered models are likely to suit better different applications and use cases.

%abstraction brings forward the social aspect of applications whose components should behave and interact based on the role they are assigned to in the organization they belong to

%patterns of interaction and behavior that compose the structure 


%behaviors (generally asymmetric) that fulfills one or more application requirements. This concept has been used by organization centered multi-agent systems~\cite{}, for which organizations are frameworks where agents with different capabilities may interact. Such abstraction brings forward the social aspect of applications whose components should behave and interact based on the role they are assigned to in the organization they belong to, going beyond the static client-server roles of today's mainstream model for mobile applications. %Figures~\ref{fig:client-server} and~\ref{fig:crowdsensing} illustrate the difference between these models.

%FIGURE: a) CLIENTS + SERVER; b) INTERACTING ROLES + SERVER


%DISCUSSION: one could argue that the dynamicity of the scenario does not fit well with the idea of a group, as the update of the group view may become constant. In this scenario, nodes could just advertise their fitness to perform different roles/tasks for a given application. Accordingly, they would still be able to build a table and decide for the allocation. The need for a group seems superfluous, unless there are many-many application nodes/roles and all of these nodes must broadcast their fitness for all eligible roles. In this case, group membership could be seen as the state in which nodes must do something while non-members must not. For instance, only group members must advertise their fitness, and the lowest threshold (lowest FV) is made public so the non-members would know when to become a member. 
%Ex: a sonore pollution group is defined with cardinality=8. There are, simultaneasly, 20 devices in the target campaign area. When the campaign is about to start, each device broadcasts its FV for that role, which allows them to build a shared FV table. The first 8 devices in the resulting FV table are considered as active. Whenever the 8th position FV threshold is met by a non-active node or by a superior position, the corresponding node advertises its FV: the node currently in the 8th position will go, respectivelly, to the 7th position or it will become a non-active member. In both cases, all nodes become have their FV table updated. Conversely, if the FV of the 8th position node changes, it must advertise this change and let other nodes to become aware of the new threshold.
%So, the group abstraction is mostly useful for modeling purposes, but also for programming and for guiding the implementation of the middleware. 