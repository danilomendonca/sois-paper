


\section{Self-organizing Interaction Spaces}\label{sec:edge_spaces}

\subsection{Role-orientation}

%behaviors and responsibilities that an individual or a group of individuals can assume. 

%8: The today's client-server model and the need for role-orientation
In today's client-server model, the functionalities to be performed by the application nodes are seen as as monolithic. For the applications whose nodes are expected to collaborate and play others than just the role of a client, the functionalities that are particular to distinct application roles form a concern of their own, i.e., they must be designed and programmed accordingly. 

%9: What do we propose in terms of role-orientation
In this work, we inherit the concept of a role, more commonly used in human organizations, as part of a framework for the engineering of pervasive applications. By making the concept of a role a first-class abstraction, we provide the means to, since the early stages of its development, reason on the organizational aspects of the application, namely:

\begin{enumerate}[label=\roman*]
	
	\item what are the roles in the application-to-be;
	
	\item what functionalities must be provided by each role;
	
	\item what capabilities are required by these functionalities; and
	
	%(e.g., computational resources, specific hardware components, etc); 
	
	\item how existing roles relate to each other: 
	
	\begin{enumerate}[label=-]
		
		\item the hierarchy of control%. E.g.: a coordinator and its coordinated;
		
		\item the flow of data%. E.g.: from sensors to an aggregator;
	
		\item the symmetry%. E.g.: symmetric relation between file-sharing peers, or asymmetric relations between server/client, supervisor/follower, coordinator/coordinated, provider/consumer, etc
		
	\end{enumerate}	
	
\end{enumerate}

%DISCUSSION
%I don't know if a need a fitness criteria or a group membership criteria.
%While the first is a comparative one, the later just filters what nodes can be or cannot be in a group.
%This doubt has much to do with the interpretation of what a group is.
%Before, a group had a stric semantical relation with the role within: a group was always a group of a specific type of agent, like a vaccum cleaner or a humidity sensor or an actuator. Thus, I have envisioned the membership criteria strongly coupled to the needs of a single role within the group.
%That been said, now I must reason on the more heterogeneous sense of a group. What if I want to define, in terms of A-3, different criteria for the followers and for the supervior? 



%Similarly to well studied allocation of tasks to agents/robots with dynamic and distinct capabilities~\cite{}, mobile devices are heterogeneous and subject to hight volatility, therefore their fitness in performing different tasks varies from one device to the other and throughout time. 

%and contextualization, the dynamic allocation of tasks to different application nodes is a central feature that further distinguishes this work from previous frameworks~\cite{}. 


%their need to send/receive from each other application data or control directives (or both). 
%For instance, a coordinator is responsible for controlling the activities of its coordinates and an aggregator is responsible for aggregating data from multiple sources. The relation between roles may be further characterized by the multiplicity in each side of the relation. 



%For this, there must be a clear separation of concerns and modularization of the application logic from different roles. 


%Whereas the type of role depends on the domain of the application, in this paper we propose general abstractions and mechanisms to address the range of pervasive applications whose functionalities may be asymmetrically distribute among its nodes. 



%The relation between roles is defined based on what they are expected to provide one another. For instance, a node may be responsible for giving control directives to other nodes or to process a batch of data from other nodes. For instance,
%TODO refine this paragraph and add examples from the other motivating scenarios 
%in opportunistic MCS, application nodes may collaborate by aggregating fetched data from multiple devices into a single device~\cite{Rajagopalan:2006}, which in turn sends a preprocessed data to the server (e.g., the one with higher battery level). Thus, one-out-of-many nodes must assume the role of an aggregator, meaning that the functional role of this node changes to fit a given context. Also, if the number of nodes at a given moment is high, not every node must perform the same sensing tasks. Instead, a subset of application nodes can be assigned to a subset of sensors, reducing the overall battery consumption and networking. Once again, the functional role of these nodes varied to reflect the context they were exposed. 

%Together, the specification of what a role does (behavior specification) and how it interacts with other roles (social specification) defines the organization structure of the application. 

%FIGURE: CIRCLE WITH HALF SYMMETRIC HALF ASYMMETRIC BEHAVIOR

%TODO: add here the fitness function definition and examples

\subsection{Groups}

\begin{figure}[t!]
	\centering
	\includegraphics[width=0.9\linewidth]{figures/group_view}
	\caption{Example of a group with a relaxed membership criteria; out of 7 members, 2 nodes are idle (light blue) and 5 nodes are playing one of two types of roles: 1 node (red) plays a role related to the role played by the 4 others nodes (orange);}
	\label{fig:group_view}
\end{figure}


%From the collective of roles to the collective of grouped roles
%Why to group nodes together?
%What defines a group?
%How grouping works?

%Further refines the context of an application node: the role is not automatically set, but must be agreed 
%Strict vs relaxed group membership
%Figure of a circle representing the set of members and an inner circle representing the active members
%Relation of a group and the physical space

%Group membership criteria filters out heterogeneity

%The paradigm shift from a bipolar into a multi-polar organization discussed by this paper is strongly motivated by the co-existence of a plethora of pervasive devices from different kinds in the physical space inhabited by people. As human society evolves and blends itself with a fabric of interconnected cyber-physical devices, a question emerges: how should this ecosystem be organized? Whereas the client-server has been proven a simple and scalable answer, the potential of peer-to-peer interactions must not be ignored.

%Three dimensions characterizes the ecosystem of applications hosted by pervasive and mobile devices: \textit{space}, \textit{time}, and \textit{heterogeneity}. 




%The combination of the social context with the individual context of each node 

%1: Briedge with the role abstraction
The application organization -- so far represented by the roles that can be played by its nodes -- may be further characterized by its divisions, here named as \textit{groups}. 

%2: What a group is for an organization
At its highest level, a group boundary is limited by the network partition in which application nodes can interact. Nonetheless, these nodes, or a subset of them, may exhibit common properties or states of interest to the application. For instance, a group may have a \textit{functional} meaning (e.g., a group of nodes able to fetch data from a specific type of sensor), a \textit{non-functional} meaning (e.g., all nodes within a specific geographical area), or a mix of both (e.g., all nodes able to fetch data from a specific type of sensor within a specific geographical area). 

%Thus, multiple types of criteria may define the membership of a group.

%2: What a group is for a node
To its members, a group defines a \textit{social context} in which they (a) may or (b) must play certain roles. As the former case can be seen as a more general case of later case, we adopt a relaxed membership causality (a), i.e., group membership only defines the context in which its members \textit{may} play one or more roles, unless the group specification makes such restriction. Each of these cases are specified as follows:

\begin{itemize}
	
	\item \textbf{Strict:} a m-m specification (m instances of a role in a group of m nodes) defines a strict membership, i.e., a role that must be played by all members.
	
	\item \textbf{Relaxed:} a k-m specification defines a relaxed membership, i.e., a role to be played by a subset $K$ of the set $M$ of nodes in the group, with $|K| = k$, $|M| = m$, and $k < m$.
	
\end{itemize}

%3: The k-out-of-m allocation problem
Whenever the group specification is relaxed, the actual distribution of roles to group members must be decided dynamically (k-out-of-m allocation problem). This kind of specification is particularly useful for applications that explore the resources from a crowd of devices. For example, in mobile crowd-sensing, due to the potentially high density of devices within a given area, there may be a surplus of nodes able to perform one or more sensing tasks. Accordingly, a crowd-sensing group could be formed by all capable nodes, and only a few would actually be playing the sensing roles (decided by the k-out-of-m allocation). Figure~\ref{fig:group_view} shows the representation of a group with relaxed membership specification and two types of roles.

%Conversely, if the relation between nodes in a group is symmetric, there is no decision to be made: all nodes must play the same role. 

%To this end, members would need to solve among them the k-out-of-m allocation problem, where $m$ is the group size (of capable nodes). In contrast, a strict membership would imply choosing nodes to become active members from all the available nodes, including those that may not fit to play the role. Thus, in these cases, a relaxed membership reduces the scope in which the decision of which nodes must play a role in the group.
 
%This decision has the advantage to reduce the role assignment scope, as eligible nodes are picked from the group and not from the whole set of application nodes. 

%for applications such as MCS, in which application nodes provides functionalities whose purpose is to address the needs of an external actor and not the users themselves, 

%4: The refined k-out-of-m allocation problem
The same logic applies to a group specified with two or more types of roles. If there is no predefined criteria for their assignment to specific nodes, e.g., based on the class of device, nodes must also agree on the specific roles they will play. Figure~\ref{fig:asymmetry} illustrates cases of both symmetrical and asymmetrical relations within a group. Finally, Figure~\ref{fig:rationale} summarizes the rationale behind assignment of functional roles the nodes of an application based on their social and individual contexts.

\begin{figure}[t!]
	\centering
	\includegraphics[width=0.48\textwidth]{figures/asymmetry}
	\caption{Left: application nodes perform the same behavior (e.g., content sharing); middle: application nodes perform asymmetric roles without hierarchy among them (e.g., different sensing tasks); right: one node performs an hierarchical control (e.g., coordinator) or communication (e.g., data aggregator).}
	\label{fig:asymmetry}
\end{figure}

%5: Role fitness and group specification
Once the cases in which roles must be dynamically assigned to the members of a group has been depicted, and before moving to the more concrete group specification, we introduce the last key concept of the framework: the \textit{role fitness}. 

\subsection{Role Fitness}

%Considering the relaxed membership and the role asymmetric discussed in the previous section, more than one type of role may co-exist in a group. Also, the distribution of roles to the group members should follow a \textit{fitness criteria}. This criteria must provide a metric indicating which nodes are best suit to play the group roles.

%1: What a role fitness is
Depending on the functionality to be provided by an application role, there may be some objective criteria to guide the decision of which nodes, at a given context, are suitable or represent the best candidates to play that role. To this end, we propose the specification of a \textit{role fitness} as a function composed of:

\begin{itemize}
	
	\item \textbf{Restrictive criteria:} consists of boolean variables whose satisfaction is a required condition for a role to be played by an application node.
	
	\item \textbf{Comparative criteria:} consists of the positive real scale indicating the fitness of a node in playing a role.
	
\end{itemize}

%The modeling of an application group starts with the specification of its membership criteria. 

%2: What each part composing a role fitness is useful for
Restrictive criteria is useful for filtering out nodes whose static (e.g., a hardware component) or dynamic (e.g., the battery level) capabilities are not compatible with the functionalities to be provided by a role. In contrast, comparative criteria further distinguishes capable nodes in terms of their fitness to play a role. Thus, such criteria must be taken into account by the solution of the k-out-of-m role allocation problem. Next, a list of static and dynamic aspects of pervasive devices are presented as potential restrictive or comparative criteria.

\begin{itemize}
	
	\item Static criteria
	
	\begin{itemize}
		\item \textbf{Hardware capabilities:} refers to the presence of a given hardware component/module. E.g.: camera, GPS, thermometer, accelerometer, gyroscope, etc.
	\end{itemize}
	
	\item Dynamic criteria
	
	\begin{itemize}
		\item \textbf{Physical world:} refers to the physical world states a node must operate in. E.g.: its current battery level, available memory, geolocation coordinates, acceleration, speed, temperature, etc.
		
		\item \textbf{Application domain:} refers to the application states a node must be to belong to a group. E.g.: currently a member of another group (or non-member), joining a chat or game session, etc.
	\end{itemize}
\end{itemize}

\subsection{Group Specification}

%As SOIS refers to the collective of application nodes and their dynamic relations, 

A group specification provides a flexible, intuitive, and unified placeholder for representing the key concepts of this framework: a group and its roles. Next, we illustrate this specification for each of the two examples in Section~\ref{sec:motivating}. For this, we used the eXtensible Markup Language (XML), as its standardized and well-known syntax enables the hierarchical representation of groups and roles, as well as the definition of their attributes.

\lstset{
	language=XML,
	breaklines=true,
	backgroundcolor=\color{lightgrey},
	basicstyle=\small\color{black},
	keywords={group,cardinality,role,name,criteria,type,term,value,minimum,maximum, pattern},
	keywordstyle={\bfseries\color{blue}},
	numbers=left,
	numbersep=5pt,
	numberstyle=\tiny\color{black}
}

\subsubsection{Collaborative Music Streaming} for this application, we envisioned one group with a single streamer role position (lines 1 and 2 in Listing~\ref{lst:ms_criteria}). As the functionalities of this role requires both Internet (to stream music from remote servers) and Bluetooth (to stream music to the stereo), two restrictive (boolean) criteria have been added for both Internet and Bluetooth capabilities (lines 3 and 4). Finally, as the activity of streaming data in both directions are battery consuming, an additional criteria (line 5) has two purposes: a restrictive one (only devices with more than 20\% battery) and a comparative one (the best candidates are those with more battery level).

\begin{lstlisting}[caption=Specification of the music streaming group, label=lst:ms_criteria, captionpos=t]
<group name="music-streaming">

  <role name="streamer" cardinality="1">
    <criteria type="boolean" term="INTERNET" value="TRUE" />
    <criteria type="boolean" term="BLUETOOTH" value="TRUE" />
    <criteria type="float" term="BATTERY_LEVEL" minimum="20" />
  </role>
</group>
\end{lstlisting}

\subsubsection{Public Transport Monitoring}  

%TODO Remember to mention the importance of saving battery and other resources as a condition for the participation of users in MCS campaings
a MCS application aims to monitor the real-time geolocation of public buses -- to notify waiting passengers about their whereabouts -- and to register and later report unusual acceleration and deceleration events that may affect the user experience in this service. To address this scenario, a \textit{bus-monitoring} group (lines 1 in Listing~\ref{lst:bm_criteria}) is defined with three roles: a geolocator (line 5), an accelerometer (line 10), and an aggregator (14). In contrast with the previous example, a group level criteria (line 3) has been added, which means all roles inherit a minimum battery level of 15\% as their criteria. This criteria is overwritten by the geolocator role (line 6), as the GPS sensor consumes significantly more battery. Each sensing role has a corresponding restrictive criteria for the sensor it requires (lines 7 and 11). Finally, as the aggregator is responsible for receiving data from the other nodes and sending a preprocessed version to the backend server, Internet has been added as a restrictive criteria.

\begin{lstlisting}[caption=Specification of a bus monitoring group, label=lst:bm_criteria, captionpos=t]
<group name="bus-monitoring">
  
  <criteria type="float" term="BATTERY_LEVEL" minimum="15" />
  
  <role name="geolocator" cardinality="k1">
    <criteria type="boolean" term="GPS" value="TRUE" />
    <criteria type="float" term="BATTERY_LEVEL" minimum="30" />
  </role>
  
  <role name="accelerometer" cardinality="k2">
    <criteria type="boolean" term="ACCELEROMETER" value="TRUE" />
  </role>
  
  <role name="aggregator" cardinality="1">
    <criteria type="boolean" term="INTERNET" value="TRUE" />
  </role>
</group>
\end{lstlisting}

To avoid disturbing the users with the need of starting the application whenever they are within a bus, a fully opportunistic crowd-sensing solution~\cite{Guo:2015} requires the automatic detection of such context. By means of our framework, the facts defining this context can be modeled and later verified by the application. For example, if we assume that city buses provide wi-fi service -- as in an increasing number of real case scenarios -- the context of a passenger inside a bus ride can be defined with the following restrictive criteria: 

\begin{lstlisting}[caption=Additional criteria to specify a bus ride context, label=lst:br_criteria, captionpos=t]
<group name="bus-monitoring">

  <criteria type="string" term="BSSID" pattern="COMPANY_NAME" />
  <criteria type="float" term="WIFI_SIGNAL" minimum="50" />
  <criteria type="boolean" term="MOOVING" value="TRUE" after="300" />
  
  (...)

</group>
\end{lstlisting}

The additional criteria in Listing~\ref{lst:br_criteria}, indicating the context of a bus ride, should be read as follows: the BSSID criteria (line 1) requires that a Wi-Fi with a basic service set identifier (BSSID) matching the pattern used by the bus company (e.g., the company's name); plus, the WI-FI signal strength (line 3) must not be less than 50\%, meaning the user is likely a passenger within the bus and not in a nearby outside location. Finally, an important criteria identifying a bus ride is given by mobility: if the device's location, as measured by low-power detection methods like triangulation, remains unchanged for large periods, the use is either not in a bus ride or the bus is jammed and must not have its location monitored until it resumes its trip. In particular, this criteria has been modeled (line 5) with a boolean condition that fails unless it has been satisfied for more than 5 minutes (300 seconds).



%\begin{itemize}
%	
%	\item Bus Group Membership Criteria
%	
%	\begin{itemize}
%		
%		\item Wi-Fi BSSID matches a well-known pattern; AND
%		
%		\item Wi-Fi signal is not weak; AND
%		
%		\item Device's location has changed in the last 5 minutes
%		
%	\end{itemize}
%	
%\end{itemize}

%With this criteria, a background service checks for a given pattern in the BSSID of the Wi-Fi detected by the device, as the transport provider is likely to use a BSSID that identifies the company service. If that pattern is found and if the corresponding signal is not weak (meaning the user is likely to be inside the bus), the last criteria filters out any device in the proximity of parked buses. Once these criteria are met, the application node may join or create a bus group.

%Each measurement target by the campaign -- geolocation and acceleration -- is provided by independent sensors -- namely GPS and accelerometer. Thus, two additional groups are specified with the following criteria:

%\begin{itemize}
%	
%	\item Geolocation Group Membership Criteria
%	
%	\begin{itemize}
%		
%		\item Member of the Bus Group; AND
%		
%		\item Has GPS; AND
%		
%		\item Battery level above 40\%
%		
%	\end{itemize}
%	
%	\item Acceleration Group Membership Criteria
%	
%	\begin{itemize}
%		
%		\item Member of the Bus Group; AND
%		
%		\item Has accelerometer; AND
%		
%		\item Battery level above 25\%
%		
%	\end{itemize}
%	
%\end{itemize}

%Both criteria are similar, except for the type of sensor the device must have and its minimum battery level. As the GPS is known for been a battery consuming sensor, a higher battery threshold has been specified, meaning only devices with 40\% of battery or more are eligible to join that group (in contrast to the minimum level of 25\% for the acceleration group). Finally, the first criteria refers to the membership to the bus group, which indicates that a node is within a bus to be monitored.


%QUESTION: is the specification of how roles should interact inherent to the role specification or to the group specification? If the interaction should happen between roles of different kinds, this specification do not belong to one role class; it can belong to the group, which allows different groups to define different architectural styles for the same class of role. Thus, I believe this specification belongs to the group in which a role is to be played. 

%Additionally, groups provide a well defined scope in which these roles can interact according to a specified architectural style. Functional groups are further associated with the roles that can 

%s a functional group is associated to a set of functionalities, its specification must also include the intended type of role(s) to be played. In addition to that, its specification must define the relation between these roles, i.e., how they interact.  

%In addition to the functional precondition aspect, a group membership criteria may also be useful to group correlated nodes according to some application semantic. For instance, 

%Due to the heterogeneity and volatility of the devices hosting a mobile application, some nodes may not satisfy the requirements to perform one or more roles. Conversely, the nodes that satisfy these requirements form a group of eligible nodes. 


%\begin{figure}[t!]
%	\centering
%	\begin{subfigure}[b]{0.4\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{figures/physical_view}
%		\caption{Spatial criteria: application components (white circles) grouped by their position in the physical space (blue shapes).}
%		\label{fig:spatial_criteria}
%	\end{subfigure}%
%	
%	\begin{subfigure}[b]{0.4\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{figures/logical_view}
%		\caption{Virtual criteria: application components (white circles) grouped by logical criteria defined by the application.}
%		\label{fig:virtual_criteria}
%	\end{subfigure}
%	\caption{Application nodes grouped by different types of criteria}
%	\label{fig:grouping_criteria}
%\end{figure}

%Whereas the isolation provided by groups can be achieved using  methods that limit the audience of messages -- for instance,  publish/subscribe mechanisms in which events are only captured by registered listeners -- the group abstraction complement the organizational view of the system provided by the role abstraction and make its social aspect more explicit. Together, these abstractions form the building blocks that allow engineers to think and program highly distributed mobile applications in terms of their organizational structure. The decision of which communication and coordination methods to use within each group remains orthogonal: message queues, events, and data-centered models are likely to suit better different applications and use cases.

%abstraction brings forward the social aspect of applications whose components should behave and interact based on the role they are assigned to in the organization they belong to

%patterns of interaction and behavior that compose the structure 


%behaviors (generally asymmetric) that fulfills one or more application requirements. This concept has been used by organization centered multi-agent systems~\cite{}, for which organizations are frameworks where agents with different capabilities may interact. Such abstraction brings forward the social aspect of applications whose components should behave and interact based on the role they are assigned to in the organization they belong to, going beyond the static client-server roles of today's mainstream model for mobile applications. %Figures~\ref{fig:client-server} and~\ref{fig:crowdsensing} illustrate the difference between these models.

%FIGURE: a) CLIENTS + SERVER; b) INTERACTING ROLES + SERVER


%DISCUSSION: one could argue that the dynamicity of the scenario does not fit well with the idea of a group, as the update of the group view may become constant. In this scenario, nodes could just advertise their fitness to perform different roles/tasks for a given application. Accordingly, they would still be able to build a table and decide for the allocation. The need for a group seems superfluous, unless there are many-many application nodes/roles and all of these nodes must broadcast their fitness for all eligible roles. In this case, group membership could be seen as the state in which nodes must do something while non-members must not. For instance, only group members must advertise their fitness, and the lowest threshold (lowest FV) is made public so the non-members would know when to become a member. 
%Ex: a sonore pollution group is defined with cardinality=8. There are, simultaneasly, 20 devices in the target campaign area. When the campaign is about to start, each device broadcasts its FV for that role, which allows them to build a shared FV table. The first 8 devices in the resulting FV table are considered as active. Whenever the 8th position FV threshold is met by a non-active node or by a superior position, the corresponding node advertises its FV: the node currently in the 8th position will go, respectivelly, to the 7th position or it will become a non-active member. In both cases, all nodes become have their FV table updated. Conversely, if the FV of the 8th position node changes, it must advertise this change and let other nodes to become aware of the new threshold.
%So, the group abstraction is mostly useful for modeling purposes, but also for programming and for guiding the implementation of the middleware. 