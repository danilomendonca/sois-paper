\section{Self-organizing Interaction Spaces}\label{sec:edge_spaces}

\begin{figure*}[t!]
	\centering
	\includegraphics[width=0.95\linewidth]{figures/rationale}
	\caption{Role-orientation rationale}
	\label{fig:rationale}
\end{figure*}

\subsection{Functional Plasticity and Separation of Responsibilities}

%A tree with the types of role: symmetric and asymmetric branches with the corresponding types of roles in increasing levels of concreteness 

%1: functional plasticity of nowaday's devices
With the technology advancements, a class of pervasive and mobile devices acquired the ability to perform general purpose computing, as well as to communicate by different means and perceive the physical world through multiple sensors. These enhancements entails a \textit{functional plasticity}, i.e., the ability of these devices to provide variations of their functionalities not only in different applications, but in different contexts of the same application. 

%2: from functional plasticity to a separation of roles
In contrast with the rigid symmetry that characterizes the behavior performed by clients nodes in a client-server architecture, commonly used in today's applications, or compared to the narrow set of functionalities provided by specialized and extremely resource-constrained devices, the functional plasticity of smartphones and other devices can be explored by letting application nodes hosted by these devices to assume distinct responsibilities, i.e., \textit{roles}.

%3: what (functional) roles are
In an organization structure, a functional role defines a context in which an individual assume the responsibility over some functionality. 
%4: why they are important for pervasive applications
Considering the collective of application nodes as an organization, different reasons may motivate a \textit{separation-of-responsibilities} among these nodes. 
%4.1a: the case of MCS; application nodes are employers of an organization, which must efficiently employ their resources
For instance, with the purpose of increasing the \textit{efficiency} in which the organization deliver its results:
	
\begin{itemize}
	\item Specific roles can be played by a subset of the available nodes (e.g., only a subset of nodes in a given region must collect data about the noise pollution);
	
	\item Roles must be played by capable nodes (e.g., only the nodes with a minimum battery level and/or computational resources)
\end{itemize}

%4.1b: why did I mention organization efficiency as a motivation
%Today, MCS is the main class of application in which mobile devices are employed not to satisfy its owners needs, but the needs of external actors (e.g., a public institution responsible for monitoring the noise pollution in certain urban areas). Despite their uniqueness, the broad range of MCS applications justifies the inclusion of efficiency as a motivation. 

%4.2: the case of collaboration among nodes
In addition, separation-or-responsibilities becomes evident whenever nodes of an application need to achieve their individual or common goals in a collaboratively way. That is:

\begin{itemize}
	
	\item When some nodes have a resource or capability and others don't (e.g., sensors, Internet connection, processing capabilities, free memory, free storage, battery level, etc);
	
	\item When a functionality that benefits multiple peers can be provided by one or a subset of them

\end{itemize}


%5: When relations among nodes can be established
Still regarding collaboration, we argue that, whenever two nodes of an application become visible to each other and are able to communicate, there is a potential for a collaborative relation between them to be established. 
%In this relation, each part plays a similar (symmetric) or different (asymmetric) roles. 
This same premise holds true for multiple interconnected devices. 

%6: The nature of the relation between nodes in different situations
While the nature of the relation between nodes hosted by devices of different classes is mostly predefined (e.g., between a smartphone and a gadged, a tablet and a smart-tv), the nature of the relation between devices of the same class may depend on the dynamic context each device operates (e.g., a smartphone that, in a given moment and situation, acts as the gateway for other smatphones without Internet access). 
%7: How the social context defines the nature of the relation between nodes when they are not predefined
Accordingly, the social context, as defined by which and how many other nodes a node can interact with at a given time, in addition to the individual context, as defined by the availability of resources and state of the node, delimit which potential relations can be established between this node and its peers. 

%Whereas a P2P file sharing can be considered as a collaboration between nodes with symmetric responsibilities (all nodes are clients and servers), in other cases a single node can address the needs of its peers, i.e., to assume an asymmetric responsibility. 

%whereas for some applications be predefined (e.g., a P2P messaging application) or 


\subsection{Role-orientation}

%behaviors and responsibilities that an individual or a group of individuals can assume. 

%8: The today's client-server model and the need for role-orientation
In today's client-server model, the functionalities to be performed by the application nodes are seen as as monolithic. For the applications whose nodes are expected to collaborate and play others than just the role of a client, the functionalities that are particular to distinct application roles form a concern of their own, i.e., they must be designed and programmed accordingly. 

%9: What do we propose in terms of role-orientation
In this work, we inherit the concept of a role, more commonly used in human organizations, as part of a framework for the engineering of pervasive applications. By making the concept of a role a first-class abstraction, we provide the means to, since the early stages of its development, reason on the organizational aspects of the application, namely:

\begin{enumerate}[label=\roman*]
	
	\item What are the roles in the application-to-be;
	
	\item What functionalities must be provided by each role;
	
	\item What capabilities are required by these functionalities; 
	
	%(e.g., computational resources, specific hardware components, etc); 
	
	\item How existing roles relate to each other: 
	
	\begin{enumerate}[label=-]
		
		\item The hierarchy of control. E.g.: a coordinator and its coordinated;
		
		\item The flow of data. E.g.: from sensors to an aggregator;
	
		\item The symmetry. E.g.: symmetric relation between file-sharing peers, or asymmetric relations between server/client, supervisor/follower, coordinator/coordinated, provider/consumer, etc
		
	\end{enumerate}	
	
\end{enumerate}

%Figure~\ref{fig:asymmetry} presents some examples of asymmetric roles played by different application nodes. 

%In this sense, the \textit{organization} formed by the collective of application nodes 

%application designers and programmers must be able to identify, model and program the functionality to be provided by different application roles.

%dynamic assignment of roles among peers according to their context.

%THE WOLRD CONTEXT (PHYSICAL + SOCIAL) --> THE NODE CONTEXT (ROLE) --> THE NODE BEHAVIOR


%Similarly to well studied allocation of tasks to agents/robots with dynamic and distinct capabilities~\cite{}, mobile devices are heterogeneous and subject to hight volatility, therefore their fitness in performing different tasks varies from one device to the other and throughout time. 

%and contextualization, the dynamic allocation of tasks to different application nodes is a central feature that further distinguishes this work from previous frameworks~\cite{}. 


%their need to send/receive from each other application data or control directives (or both). 
%For instance, a coordinator is responsible for controlling the activities of its coordinates and an aggregator is responsible for aggregating data from multiple sources. The relation between roles may be further characterized by the multiplicity in each side of the relation. 



%For this, there must be a clear separation of concerns and modularization of the application logic from different roles. 


%Whereas the type of role depends on the domain of the application, in this paper we propose general abstractions and mechanisms to address the range of pervasive applications whose functionalities may be asymmetrically distribute among its nodes. 



%The relation between roles is defined based on what they are expected to provide one another. For instance, a node may be responsible for giving control directives to other nodes or to process a batch of data from other nodes. For instance,
%TODO refine this paragraph and add examples from the other motivating scenarios 
%in opportunistic MCS, application nodes may collaborate by aggregating fetched data from multiple devices into a single device~\cite{Rajagopalan:2006}, which in turn sends a preprocessed data to the server (e.g., the one with higher battery level). Thus, one-out-of-many nodes must assume the role of an aggregator, meaning that the functional role of this node changes to fit a given context. Also, if the number of nodes at a given moment is high, not every node must perform the same sensing tasks. Instead, a subset of application nodes can be assigned to a subset of sensors, reducing the overall battery consumption and networking. Once again, the functional role of these nodes varied to reflect the context they were exposed. 

%Together, the specification of what a role does (behavior specification) and how it interacts with other roles (social specification) defines the organization structure of the application. 

%FIGURE: CIRCLE WITH HALF SYMMETRIC HALF ASYMMETRIC BEHAVIOR

%TODO: add here the fitness function definition and examples

\subsection{Groups}

\begin{figure}[t!]
	\centering
	\includegraphics[width=0.85\linewidth]{figures/group_view}
	\caption{Example of a group with a relaxed membership criteria; out of 7 members, 2 nodes are idle (light blue) and 5 nodes are playing one of two types of roles: 1 node (red) plays a role related to the role played by the 4 others nodes (orange);}
	\label{fig:group_view}
\end{figure}


%From the collective of roles to the collective of grouped roles
%Why to group nodes together?
%What defines a group?
%How grouping works?

%Further refines the context of an application node: the role is not automatically set, but must be agreed 
%Strict vs relaxed group membership
%Figure of a circle representing the set of members and an inner circle representing the active members
%Relation of a group and the physical space

%Group membership criteria filters out heterogeneity

%The paradigm shift from a bipolar into a multi-polar organization discussed by this paper is strongly motivated by the co-existence of a plethora of pervasive devices from different kinds in the physical space inhabited by people. As human society evolves and blends itself with a fabric of interconnected cyber-physical devices, a question emerges: how should this ecosystem be organized? Whereas the client-server has been proven a simple and scalable answer, the potential of peer-to-peer interactions must not be ignored.

%Three dimensions characterizes the ecosystem of applications hosted by pervasive and mobile devices: \textit{space}, \textit{time}, and \textit{heterogeneity}. 


%Figure~\ref{fig:rationale} illustrates the rationale behind the assignment of roles to an application node.

%The combination of the social context with the individual context of each node 

%10: 
The application organization -- so far represented by the roles that can be played by its nodes -- may be further characterized by its partitions, here named as \textit{groups}. 
At its highest level, a group correspond to the network partition in which application nodes can interact. Nonetheless, these nodes, or a subset of them, may exhibit common properties or states of interest to the application. For instance, a group may have a \textit{functional} meaning (e.g., a group of nodes able to fetch data from a specific type of sensor), a \textit{non-functional} meaning (e.g., all nodes within a specific geographical area), or a mix of both (e.g., all nodes able to fetch data from a specific type of sensor within a specific geographical area). Thus, multiple types of criteria may define the membership of a group.

To its members, a group defines a \textit{social context} in which they (a) may or (b) must play certain roles. Whenever the relation between nodes in a group is asymmetric, and there is no predefined criteria, nodes must agree on the specific roles they will play (a). Conversely, if the relation between nodes in a group is symmetric, there is no decision to be made: all nodes must play the same role (b). However, as (a) can be seen as a more general case of (b), we adopt a relaxed membership causality, i.e., group membership only defines the context in which its members \textit{may} play one or more roles, unless its specification makes such restriction. Accordingly, each of these cases can be specified as:

\begin{itemize}
	
	\item \textbf{Symmetric:} A m-m specification (m instances of a role in a group of m nodes) defines a symmetric role, i.e., a role played by all group members (strict membership causality);
	
	\item \textbf{Asymmetric:} A k-m specification defines an asymmetric role, i.e., a role played by a subset $K$ of the set $M$ of nodes in the group, with $|K| = k$, $|M| = m$, and $k < m$;
	
	
\end{itemize}

%TODO: look out for the difference between asymmetric group-role relation and asymmetric role-role relation

The later case encompasses any kind of asymmetric relation between roles, including the common cases in which one node in the group interacts with all other members through an hierarchical relation (e.g., a supervisor and its followers~\cite{Baresi:2011}). Furthermore, once this specification exists, group members must agree on the actual allocation of roles. Such \textit{distributed role allocation} mechanism is presented in Section~\ref{sec:self_organization}. Figure~\ref{fig:asymmetry} illustrates examples of both symmetrical and asymmetrical relations within a group. 

\begin{figure}[t!]
	\centering
	\includegraphics[width=0.48\textwidth]{figures/asymmetry}
	\caption{Left: application nodes perform the same behavior (e.g., content sharing); middle: application nodes perform asymmetric roles without hierarchy among them (e.g., different sensing tasks); right: one node performs an hierarchical control (e.g., coordinator) or communication (e.g., data aggregator).}
	\label{fig:asymmetry}
\end{figure}


%Due to the potentially high density of application nodes within a given zone/network, there may be a surplus of nodes able to perform one or more roles. Hence, instead of adopting a strict causality (I) between group membership and the role(s) to be played, we adopt a relaxed causality (II) in which group membership defines only the context in which its members \textit{may} play certain roles (precondition). This decision has the advantage to reduce the role assignment scope, as eligible nodes are picked from the group and not from the whole set of application nodes. 

%for applications such as MCS, in which application nodes provides functionalities whose purpose is to address the needs of an external actor and not the users themselves, 




%For example, 10 out of 15 devices are capable to measure the noise level, but only two are needed. In one hand, if the membership to a noise-pollution group would imply sensing the noise (I), only two nodes would be allowed in the group. Also, the distributed election of these two members would include all 15 devices, even those not able to perform such behavior. In the other hand, if membership implies capability (II), all 10 capable nodes would join the group and the distributed election of the two nodes would happen among the 10 member.

%Hence, at a first level, groups provide a subspace in which its members may (II) play specific roles. 

%TODO: go into details about what happens once a group is formed and roles are allocated, i.e., how roles interact with each other



Within a group, member nodes are aware of each other. Not only they can agree on which roles should be performed by which nodes, the elected roles can engage in interactions following an architectural style specified for them. Thus, a group abstraction provides a container to which roles can be added or removed dynamically. Considering the functional plasticity and role asymmetric previously discussed, more than one type of role may co-exist in a group. Also, the distribution of roles to the group members should follow a \textit{fitness criteria}. This criteria must provide a metric indicating which nodes are best suit to play the group roles.

The modeling of an application group starts with the specification of its membership criteria. Any type of criteria that can be modeled as a proposition and evaluated is a potential criteria, including:

\begin{itemize}
	
	\item Static criteria
	
	\begin{itemize}
		
		\item \textbf{Hardware capabilities:} refers to the presence of a given hardware component/module. E.g.: camera, GPS, thermometer, accelerometer, gyroscope, etc.
		
	\end{itemize}
	
	\item Dynamic criteria
	
	\begin{itemize}
		
		\item \textbf{Physical world:} refers to the physical world states a node must operate in. E.g.: its current battery level, available memory, geolocation coordinates, acceleration, speed, temperature, etc.
		
		\item \textbf{Application domain:} refers to the application states a node must be to belong to a group. E.g.: currently a member of another group (or non-member), joining a chat or game session, etc.
		
	\end{itemize}
	
\end{itemize}

For example, a mobile crowdsensing campaign is designed to monitor the real-time geolocation of public buses in a city and to register unusual acceleration and deceleration events that may affect the user experience in this service. To avoid disturbing the users with the need of starting the application whenever they are within a bus, an opportunistic approach~\cite{} requires the automatic detection of such context. In this example, we assume city buses to provide wi-fi. Accordingly, a \textit{bus group} is specified with the following criteria:

\begin{itemize}
	
	\item Bus Group Membership Criteria
	
	\begin{itemize}
		
		\item Wi-Fi BSSID matches a well-known pattern; AND
		
		\item Wi-Fi signal is not weak; AND
		
		\item Device's location has changed in the last 5 minutes
		
	\end{itemize}
	
\end{itemize}

With this criteria, a background service checks for a given pattern in the BSSID of the Wi-Fi detected by the device, as the transport provider is likely to use a BSSID that identifies the company service. If that pattern is found and if the corresponding signal is not weak (meaning the user is likely to be inside the bus), the last criteria filters out any device in the proximity of parked buses. Once these criteria are met, the application node may join or create a bus group.

Each measurement target by the campaign -- geolocation and acceleration -- is provided by independent sensors -- namely GPS and accelerometer. Thus, two additional groups are specified with the following criteria:

\begin{itemize}
	
	\item Geolocation Group Membership Criteria
	
	\begin{itemize}
		
		\item Member of the Bus Group; AND
		
		\item Has GPS; AND
		
		\item Battery level above 40\%
		
	\end{itemize}
	
	\item Acceleration Group Membership Criteria
	
	\begin{itemize}
		
		\item Member of the Bus Group; AND
		
		\item Has accelerometer; AND
		
		\item Battery level above 25\%
		
	\end{itemize}
	
\end{itemize}

Both criteria are similar, except for the type of sensor the device must have and its minimum battery level. As the GPS is known for been a battery consuming sensor, a higher battery threshold has been specified, meaning only devices with 40\% of battery or more are eligible to join that group (in contrast to the minimum level of 25\% for the acceleration group). Finally, the first criteria refers to the membership to the bus group, which indicates that a node is within a bus to be monitored.


%QUESTION: is the specification of how roles should interact inherent to the role specification or to the group specification? If the interaction should happen between roles of different kind, this specification do not belong to one role class; it can belong to the group, which allows different groups to define different architectural styles for the same class of role. Thus, I believe this specification belongs to the group in which a role is to be played. 

%Additionally, groups provide a well defined scope in which these roles can interact according to a specified architectural style. Functional groups are further associated with the roles that can 

%s a functional group is associated to a set of functionalities, its specification must also include the intended type of role(s) to be played. In addition to that, its specification must define the relation between these roles, i.e., how they interact.  

%In addition to the functional precondition aspect, a group membership criteria may also be useful to group correlated nodes according to some application semantic. For instance, 

%Due to the heterogeneity and volatility of the devices hosting a mobile application, some nodes may not satisfy the requirements to perform one or more roles. Conversely, the nodes that satisfy these requirements form a group of eligible nodes. 


%\begin{figure}[t!]
%	\centering
%	\begin{subfigure}[b]{0.4\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{figures/physical_view}
%		\caption{Spatial criteria: application components (white circles) grouped by their position in the physical space (blue shapes).}
%		\label{fig:spatial_criteria}
%	\end{subfigure}%
%	
%	\begin{subfigure}[b]{0.4\textwidth}
%		\centering
%		\includegraphics[width=1\textwidth]{figures/logical_view}
%		\caption{Virtual criteria: application components (white circles) grouped by logical criteria defined by the application.}
%		\label{fig:virtual_criteria}
%	\end{subfigure}
%	\caption{Application nodes grouped by different types of criteria}
%	\label{fig:grouping_criteria}
%\end{figure}

%Whereas the isolation provided by groups can be achieved using  methods that limit the audience of messages -- for instance,  publish/subscribe mechanisms in which events are only captured by registered listeners -- the group abstraction complement the organizational view of the system provided by the role abstraction and make its social aspect more explicit. Together, these abstractions form the building blocks that allow engineers to think and program highly distributed mobile applications in terms of their organizational structure. The decision of which communication and coordination methods to use within each group remains orthogonal: message queues, events, and data-centered models are likely to suit better different applications and use cases.

%abstraction brings forward the social aspect of applications whose components should behave and interact based on the role they are assigned to in the organization they belong to

%patterns of interaction and behavior that compose the structure 


%behaviors (generally asymmetric) that fulfills one or more application requirements. This concept has been used by organization centered multi-agent systems~\cite{}, for which organizations are frameworks where agents with different capabilities may interact. Such abstraction brings forward the social aspect of applications whose components should behave and interact based on the role they are assigned to in the organization they belong to, going beyond the static client-server roles of today's mainstream model for mobile applications. %Figures~\ref{fig:client-server} and~\ref{fig:crowdsensing} illustrate the difference between these models.

%FIGURE: a) CLIENTS + SERVER; b) INTERACTING ROLES + SERVER


%DISCUSSION: one could argue that the dynamicity of the scenario does not fit well with the idea of a group, as the update of the group view may become constant. In this scenario, nodes could just advertise their fitness to perform different roles/tasks for a given application. Accordingly, they would still be able to build a table and decide for the allocation. The need for a group seems superfluous, unless there are many-many application nodes/roles and all of these nodes must broadcast their fitness for all eligible roles. In this case, group membership could be seen as the state in which nodes must do something while non-members must not. For instance, only group members must advertise their fitness, and the lowest threshold (lowest FV) is made public so the non-members would know when to become a member. 
%Ex: a sonore pollution group is defined with cardinality=8. There are, simultaneasly, 20 devices in the target campaign area. When the campaign is about to start, each device broadcasts its FV for that role, which allows them to build a shared FV table. The first 8 devices in the resulting FV table are considered as active. Whenever the 8th position FV threshold is met by a non-active node or by a superior position, the corresponding node advertises its FV: the node currently in the 8th position will go, respectivelly, to the 7th position or it will become a non-active member. In both cases, all nodes become have their FV table updated. Conversely, if the FV of the 8th position node changes, it must advertise this change and let other nodes to become aware of the new threshold.
%So, the group abstraction is mostly useful for modeling purposes, but also for programming and for guiding the implementation of the middleware. 